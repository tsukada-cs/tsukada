<script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-MML-AM_CHTML">
</script>
<script type="text/x-mathjax-config">
 MathJax.Hub.Config({
 tex2jax: {
 inlineMath: [['$', '$'] ],
 displayMath: [ ['$$','$$'], ["\\[","\\]"] ]
 }
 });
</script>

## 共分散行列が半正定値行列であることの証明  
共分散行列が半正定値行列であることを証明する。まずは行列の定値性について説明し、共分散行列について述べる。

<hr>

### 行列の定値性
$n$ 次対称行列 $S$ には「定値性」という、符号のような概念が存在する。普通の数に正負があるように、対称行列に対しても符号を定義したものと思って良い。定義は後述するが、正の符号をもつ行列を「正定値行列」などと表現し、定値性は任意の列ベクトル $v$ に対して $v^TSv$ （二次形式と呼ばれる形）が、一定の符号を持つか否かで判断される。「$S$ の成分が全て正なら正定値」というような考え方は誤りである。なお、実際にはエルミート行列に拡張しても同じことが定義できるが、ここでは実対称行列で説明する。  

行列の定値性は、任意の列ベクトル $v$ に対する二次形式 $v^TSv$ を用いて次のように判断される: 
* 正定値: 常に $v^TSv > 0$ である
* 半正定値: 常に $v^TSv \geq 0$ である
* 負定値: 常に $v^TSv < 0$ である
* 半負定値: 常に $v^TSv \leq 0$ である
* 不定値: 上記のどれにも当てはまらない（$v$ によって  $v^TSv$ の符号が変化する）

これがわかることの嬉しい点について記述する。  
対称行列 $S$ は 直交行列によって固有値分解できる: 
$$
S = P \Lambda P^T
$$
これを用いて二次形式を書き換えると、
$$
v^TSv = v^TP \Lambda P^T v
$$
さらに、$u = P^T v$（直交行列はベクトルを回転するので、ベクトル $u$ は ベクトル $v$ を回転したもの）とおくと、二次形式は
$$
v^TSv = u^T \Lambda u = (u_1,\dots,u_n)\begin{pmatrix}
\lambda_1 & \cdots & 0\cr
\vdots & \ddots & \vdots\cr
0 & \cdots & \lambda_n\cr
\end{pmatrix}\begin{pmatrix}u_1 \cr \vdots \cr u_n\end{pmatrix} = \sum \lambda_i u_i^2
$$
となり、これが任意のベクトル $v$ （と、それに対応するベクトル $u$）に対して一定の符号を取るのなら、それは全ての固有値の正負と結びつけることができ、次の関係を得ることができる: 
* 全ての固有値が正 ⇔ 行列 $S$ は正定値行列
* 全ての固有値が非負 ⇔ 行列 $S$ は半正定値行列
* 全ての固有値が負 ⇔ 行列 $S$ は負定値行列
* 全ての固有値が非正 ⇔ 行列 $S$ は半負定値行列
* 不定値: 少なくとも一つの固有値が正で、少なくとも一つの固有値が負 ⇔ 行列 $S$ は不定値行列
  
<hr>

### 共分散行列は半正定値行列である  
$(x,y)$ それぞれの平均が事前に引かれた行列 $X$ の共分散行列 $S$ を考える。

$$
S = \frac{1}{n-1}XX^T = \frac{1}{n-1}\begin{pmatrix}
x_1 & x_2 & \cdots & x_n\cr
y_1 & y_2 & \cdots & y_n\cr
\end{pmatrix}\begin{pmatrix}
x_1 & y_1\cr
x_2 & y_2\cr
\vdots & \vdots\cr
y_n & y_n\cr
\end{pmatrix} = \frac{1}{n-1}
\begin{pmatrix}
\sum{x_i^2} & \sum{x_iy_i} \cr
\sum{y_ix_i} & \sum{y_i^2}
\end{pmatrix}
$$ 

である。共分散行列 $S$ が半正定値行列であることを示す。行列 $S$ の $v=\begin{pmatrix}a \cr b\end{pmatrix}$ に対する二次形式は

$$
v^TSv = (a, b) \begin{pmatrix}
S_{xx} & S_{xy} \cr
S_{xy} & S_{yy}
\end{pmatrix}
\begin{pmatrix}
a \cr
b
\end{pmatrix} = (a, b)
\begin{pmatrix}
aS_{xx} + bS_{xy} \cr
aS_{xy} + bS_{yy}
\end{pmatrix} = a^2S_{xx} + 2abS_{xy} + b^2S_{yy}
$$

と表される。これが非負であることを示せば良い。  
実は、上記の二次形式は、次のベクトル $Z$: 

$$
Z = v^TX = (a,b)
\begin{pmatrix}
x_1 & x_2 & \cdots & x_n\cr
y_1 & y_2 & \cdots & y_n\cr
\end{pmatrix}
= (ax_1+by_1, \dots, ax_n+by_n)
$$
の分散に一致する。この一致を示すことができれば、分散は非負であるため上記の二次形式が非負であることを示したことになる。

まず、$Z$ の平均値 $\mu$ は $0$ である（$X$ の平均は $(x,y)$ それぞれ $0$ なので）: 
$$
\mu = \frac{\sum(ax_i+by_i)}{n} = \frac{a\sum x_i+b\sum y_i}{n} = 0
$$
よって、$Z$ の分散 $Var$ は
$$
Z = \frac{\sum(ax_i+by_i)^2}{n-1} = \frac{a\sum x_i^2 + 2ab\sum x_iy_i + b^2\sum y_i^2}{n-1} = a^2S_{xx} + 2abS_{xy} + b^2S_{yy} \geq 0
$$
である。以上より、
$$
v^TSv \geq 0
$$
つまり、共分散行列 $S$ が半正定値行列であることが示された。